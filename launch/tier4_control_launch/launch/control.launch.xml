<launch>
  <arg name="lateral_controller_mode"/>
  <arg name="longitudinal_controller_mode"/>
  <arg name="trajectory_follower_node_param_path"/>
  <arg name="check_external_emergency_heartbeat"/>
  <arg name="lat_controller_param_path"/>
  <arg name="lon_controller_param_path"/>
  <arg name="lane_departure_checker_param_path"/>
  <arg name="shift_decider_param_path"/>
  <arg name="vehicle_cmd_gate_param_path"/>
  <arg name="operation_mode_transition_manager_param_path"/>

  <!-- scenario selector -->
  <group>
    <!-- external velocity limit selector -->
    <group>
      <node_container pkg="rclcpp_components" exec="component_container" name="control_container" namespace="">
        <composable_node pkg="tier4_autoware_utils" plugin="tier4_autoware_utils::LoggerLevelConfigureNode" name="container_logger_configure" namespace=""/>

        <composable_node pkg="trajectory_follower_node" plugin="autoware::motion::control::trajectory_follower_node::Controller" name="controller_node_exe" namespace="trajectory_follower">
          <!-- params -->
          <param from="$(var vehicle_param_file)"/>
          <param from="$(var nearest_search_param_path)"/>
          <param from="$(var lat_controller_param_path)"/>
          <param from="$(var lon_controller_param_path)"/>
          <param from="$(var trajectory_follower_node_param_path)"/>
          <param name="lateral_controller_mode" value="$(var lateral_controller_mode)"/>
          <param name="longitudinal_controller_mode" value="$(var longitudinal_controller_mode)"/>
          <!-- input topic remap -->
          <remap from="~/input/reference_trajectory" to="/planning/scenario_planning/trajectory"/>
          <remap from="~/input/current_odometry" to="/localization/kinematic_state"/>
          <remap from="~/input/current_steering" to="/vehicle/startus/steering_status"/>
          <remap from="~/input/current_accel" to="/localization/acceleration"/>
          <remap from="~/input/current_operation_mode" to="/system/operation_mode/state"/>
          <!-- output topic remap -->
          <remap from="~/output/predicted_trajectory" to="lateral/predicted_trajectory"/>
          <remap from="~/output/lateral_diagnostic" to="lateral/diagnostic"/>
          <remap from="~/output/slope_angle" to="longitudinal/slope_angle"/>
          <remap from="~/output/longitudinal_diagnostic" to="longitudinal/diagnostic"/>
          <remap from="~/output/stop_reason" to="longitudinal/stop_reason"/>
          <remap from="~/output/control_cmd" to="control_cmd"/>
          <!-- composable node config -->
          <extra_arg name="use_intra_process_comms" value="false"/>
        </composable_node>

        <composable_node pkg="lane_departure_checker" plugin="lane_departure_checker::LaneDepartureCheckerNode" name="lane_departure_checker_node" namespace="trajectory_follower">
          <!-- params -->
          <param from="$(var vehicle_param_file)"/>
          <param from="$(var nearest_search_param_path)"/>
          <param from="$(var lane_departure_checker_param_path)"/>
          <!-- input topic remap -->
          <remap from="~/input/reference_trajectory" to="/planning/scenario_planning/trajectory"/>
          <remap from="~/input/odometry" to="/localization/kinematic_state"/>
          <remap from="~/input/route" to="/planning/mission_planning/route"/>
          <remap from="~/input/lanelet_map_bin" to="/map/vector_map"/>
          <remap from="~/input/predicted_trajectory" to="/control/trajectory_follower/lateral/predicted_trajectory"/>
          <!-- composable node config -->
          <extra_arg name="use_intra_process_comms" value="false"/>
        </composable_node>

        <composable_node pkg="shift_decider" plugin="ShiftDecider" name="shift_decider" namespace="">
          <!-- params -->
          <param from="$(var shift_decider_param_path)"/>
          <!-- input topic remap -->
          <remap from="~/input/control_cmd" to="/control/trajectory_follower/control_cmd"/>
          <remap from="~/input/state" to="/autoware/state"/>
          <remap from="~/input/current_gear" to="/vehicle/status/gear_status"/>
          <!-- output topic remap -->
          <remap from="~/output/gear_cmd" to="/control/shift_decider/gear_cmd"/>
          <!-- composable node config -->
          <extra_arg name="use_intra_process_comms" value="false"/>
        </composable_node>

        <composable_node pkg="vehicle_cmd_gate" plugin="vehicle_cmd_gate::VehicleCmdGate" name="vehicle_cmd_gate" namespace="">
          <!-- params -->
          <param from="$(var vehicle_param_file)"/>
          <param from="$(var vehicle_cmd_gate_param_path)"/>
          <param name="check_external_emergency_heartbeat" value="$(var check_external_emergency_heartbeat)"/>
          <!-- input topic remap -->
          <remap from="input/steering" to="/vehicle/status/steering_status"/>
          <remap from="input/operation_mode" to="/system/operation_mode/state"/>
          <remap from="input/auto/control_cmd" to="/control/trajectory_follower/control_cmd"/>
          <remap from="input/auto/turn_indicators_cmd" to="/planning/turn_indicators_cmd"/>
          <remap from="input/auto/hazard_lights_cmd" to="/planning/hazard_lights_cmd"/>
          <remap from="input/auto/gear_cmd" to="/control/shift_decider/gear_cmd"/>
          <remap from="input/external/control_cmd" to="/external/selected/control_cmd"/>
          <remap from="input/external/turn_indicators_cmd" to="/external/selected/turn_indicators_cmd"/>
          <remap from="input/external/hazard_lights_cmd" to="/external/selected/hazard_lights_cmd"/>
          <remap from="input/external/gear_cmd" to="/external/selected/gear_cmd"/>
          <remap from="input/external_emergency_stop_heartbeat" to="/external/selected/heartbeat"/>
          <remap from="input/gate_mode" to="/control/gate_mode_cmd"/>
          <remap from="input/emergency/control_cmd" to="/emergency/selected/control_cmd"/>
          <remap from="input/emergency/hazard_lights_cmd" to="/emergency/selected/hazard_lights_cmd"/>
          <remap from="input/emergency/gear_cmd" to="/emergency/selected/gear_cmd"/>
          <remap from="input/mrm_state" to="/system/fail_safe/mrm_state"/>
          <remap from="input/kinematics" to="/localization/kinematic_state"/>
          <remap from="input/acceleration" to="/localization/acceleration"/>
          <remap from="input/engage" to="/autoware/engage"/>
          <!-- output topic remap -->
          <remap from="output/vehicle_cmd_emergency" to="/control/command/emergency_cmd"/>
          <remap from="output/control_cmd" to="/control/command/control_cmd"/>
          <remap from="output/turn_indicators_cmd" to="/control/command/turn_indicators_cmd"/>
          <remap from="output/hazard_lights_cmd" to="/control/command/hazard_lights_cmd"/>
          <remap from="output/gear_cmd" to="/control/command/gear_cmd"/>
          <remap from="output/gate_mode" to="/control/current_gate_mode"/>
          <remap from="output/engage" to="/api/autoware/get/engage"/>
          <remap from="output/external_emergency" to="/api/autoware/get/emergency"/>
          <remap from="output/operation_mode" to="/control/vehicle_cmd_gate/operation_mode"/>
          <!-- service topic remap -->
          <remap from="~/service/engage" to="/api/autoware/set/engage"/>
          <remap from="~/service/external_emergency" to="/api/autoware/set/emergency"/>
          <remap from="~/service/external_emergency_stop" to="~/external_emergency_stop"/>
          <remap from="~/service/clear_external_emergency_stop" to="~/clear_external_emergency_stop"/>
          <!-- composable node config -->
          <extra_arg name="use_intra_process_comms" value="false"/>
        </composable_node>

        <composable_node pkg="operation_mode_transition_manager" plugin="operation_mode_transition_manager::OperationModeTransitionManager" name="operation_mode_transition_manager" namespace="">
          <!-- params -->
          <param from="$(var vehicle_param_file)"/>
          <param from="$(var nearest_search_param_path)"/>
          <param from="$(var operation_mode_transition_manager_param_path)"/>
          <!-- input topic remap -->
          <remap from="kinematics" to="/localization/kinematic_state"/>
          <remap from="steering" to="/vehicle/status/steering_status"/>
          <remap from="trajectory" to="/planning/scenario_planning/trajectory"/>
          <remap from="control_cmd" to="/control/command/control_cmd"/>
          <remap from="trajectory_follower_control_cmd" to="/control/trajectory_follower/control_cmd"/>
          <remap from="control_mode_report" to="/vehicle/status/control_mode"/>
          <remap from="gate_operation_mode" to="/control/vehicle_cmd_gate/operation_mode"/>
          <!-- output topic remap -->
          <remap from="is_autonomous_available" to="/control/is_autonomous_available"/>
          <remap from="control_mode_request" to="/control/control_mode_request"/>
          <!-- composable node config -->
          <extra_arg name="use_intra_process_comms" value="false"/>
        </composable_node>

        <composable_node pkg="glog_component" plugin="GlogComponent" name="glog_component" namespace=""/>
      </node_container>
    </group>
  </group>
</launch>
